{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'restaurants/css/detail.css' %}">
{% endblock %}

{% block content %}
<div class="detail-container">
  <div class="detail-card">

  
  <div class="restaurant-info">
    <h2>{{ restaurant.store_name }}</h2>

    {% if restaurant.url %}
      {% if "instagram.com" in restaurant.url %}
        <blockquote class="instagram-media"
                    data-instgrm-permalink="{{ restaurant.url }}"
                    data-instgrm-version="14"></blockquote>
        <script async src="//www.instagram.com/embed.js"></script>
      {% elif "tiktok.com" in restaurant.url %}
        <blockquote class="tiktok-embed" cite="{{ restaurant.url }}">
          <a href="{{ restaurant.url }}">TikTokを開く</a>
        </blockquote>
        <script async src="https://www.tiktok.com/embed.js"></script>
      {% else %}
        <a href="{{ restaurant.url }}" target="_blank">{{ restaurant.url }}</a>
      {% endif %}
    {% endif %}

    <div class="restaurant-details">
  <p class="line">
    {% if restaurant.area %}{{ restaurant.area }}{% endif %}
    {% if restaurant.genre %}　{{ restaurant.genre }}{% endif %}
    {% if restaurant.scene %}　{{ restaurant.scene }}{% endif %}
    {% if restaurant.companions %}　{{ restaurant.companions }}{% endif %}
  </p>

  {% if restaurant.tags.all %}
  <p class="line">
    {% for tag in restaurant.tags.all %}
      {{ tag.name }}{% if not forloop.last %}　{% endif %}
    {% endfor %}
  </p>
  {% endif %}

  {% if restaurant.holiday %}
  <p class="line">休業日　{{ restaurant.holiday }}</p>
  {% endif %}
</div>


    <a href="{% url 'restaurants:restaurant_list_want' %}" class="back-link">← 一覧へ戻る</a>
  </div>

  <!-- 訪問記録フォーム -->
  <div class="visit-form-section">
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="photo-upload">
        <label for="id_images" class="upload-label">＋</label>
        <input type="file" name="images" id="id_images" multiple hidden>
        <p class="upload-text">写真を追加<br>(1回の訪問につき5枚まで)</p>
        <div id="image-count" class="image-count"></div>
      </div>

      <script>
document.addEventListener('DOMContentLoaded', function() {
  const imageInput = document.getElementById('id_images');
  const imageCount = document.getElementById('image-count');
  imageInput.addEventListener('change', function() {
    const count = this.files.length;
    imageCount.textContent = count > 0 ? `${count}枚選択中` : '';
  });
});
</script>


<div class="visit-date-section">
  <label for="id_date">訪問日</label>

  <div class="date-wrapper">
    <input type="date" name="date" id="id_date" class="visit-date" required>
    <span class="date-placeholder">選択してください</span>
  </div>
</div>



      <textarea name="comment" placeholder="感想・思い出を入力" class="comment-box"></textarea>

<div class="rating">
  <p>お気に入り度</p>
  <div class="stars">
    <span class="star" data-value="1">★</span>
    <span class="star" data-value="2">★</span>
    <span class="star" data-value="3">★</span>
    <span class="star" data-value="4">★</span>
    <span class="star" data-value="5">★</span>
  </div>
  <input type="hidden" name="rating" id="rating-value" value="">
</div>

<div class="feeling-select">
  <label for="id_feeling">気持ち評価</label>
  <select name="feeling" id="id_feeling">
    <option value="">選択してください</option>
    <option value="again">また行きたい</option>
    <option value="recommend">おすすめしたい</option>
    <option value="no">もう行かない</option>
  </select>
</div>

<button type="submit" class="btn-went">行った</button>
</form>

<form method="post" action="{% url 'restaurants:restaurant_delete' restaurant.pk %}">
  {% csrf_token %}
  <button type="submit" class="btn-delete"
            onclick="return confirm('このお店を削除しますか？');">
      削除
</form>
  </div>
  <p class="note">※このボタンを押すと、<br>「気になる一覧」から削除されます。</p>
 </div>
</div>

<div class="back-link">
  <a href="{% url 'restaurants:restaurant_list_want' %}">一覧へ戻る</a>
</div>

<script src="{% static 'restaurants/js/star_rating.js' %}"></script>

{% endblock %}