{% extends "base.html" %}

{% block content %}
  <h2>{{ restaurant.store_name }}</h2>

  {% if restaurant.url %}
    <p>URL: <a href="{{ restaurant.url }}" target="_blank">{{ restaurant.url }}</a></p>
  {% endif %}

  {% if restaurant.area %}
    <p>エリア: {{ restaurant.area }}</p>
  {% endif %}

  {% if restaurant.companions %}
    <p>グループ: {{ restaurant.companions }}</p>
  {% endif %}

  {% if restaurant.genre %}
    <p>ジャンル: {{ restaurant.genre }}</p>
  {% endif %}

  {% if restaurant.scene %}
    <p>シーン: {{ restaurant.scene }}</p>
  {% endif %}

  {% if restaurant.tags.all %}
    <p>タグ:
      {% for tag in restaurant.tags.all %}
        {{ tag.name }}{% if not forloop.last %}, {% endif %}
      {% endfor %}
    </p>
  {% endif %}

  {% if restaurant.holiday %}
    <p>休業日: {{ restaurant.holiday }}</p>
  {% endif %}

  <p>登録日: {{ restaurant.created_at|date:"Y-m-d H:i" }}</p>

  <a href="{% url 'restaurants:restaurant_list' %}">一覧に戻る</a>

  <hr>

  <h3>このお店に行った記録を追加する</h3>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">行った</button>
  </form>

  <hr>

  <h3>行った記録</h3>
  {% if visits %}
    {% for visit in visits %}
      <div style="margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 8px;">
        <p><strong>訪問日:</strong> {{ visit.date }}</p>
        <p><strong>コメント:</strong> {{ visit.comment }}</p>
        <p><strong>評価:</strong> ★{{ visit.rating }}</p>
        <p><strong>気持ち:</strong> {{ visit.get_feeling_display }}</p>

        {% if visit.images.all %}
          <div style="margin-top: 10px;">
            <strong>画像:</strong><br>
            {% for image in visit.images.all %}
              <img src="{{ image.image.url }}" alt="訪問画像" style="width: 200px; margin-right: 10px; border-radius: 4px;">
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>まだ訪問記録はありません。</p>
  {% endif %}

  <a href="{% url 'restaurants:restaurant_list' %}">一覧に戻る</a>
{% endblock %}
