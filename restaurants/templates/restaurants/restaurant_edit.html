{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'restaurants/css/register.css' %}">
<link rel="stylesheet" href="{% static 'restaurants/css/tag.css' %}">
{% endblock %}

{% block content %}
<div class="register-container">
  <h2>店舗情報を編集</h2>

  <form method="post">
    {% csrf_token %}

    <!-- 店名 -->
    <p>
      <label for="id_store_name">店名（必須）</label>
      <input type="text" id="id_store_name" name="store_name"
             value="{{ form.instance.store_name }}" required>
    </p>

    <!-- URL -->
    <p>
      <label for="id_url">URL</label>
      <input type="text" id="id_url" name="url"
       value="{{ form.instance.url|default_if_none:'' }}">

    </p>

    <!-- エリア -->
    <p>
      <label>エリア（必須）</label>
      <div class="input-with-arrow">
        <input type="text" id="id_area" name="area"
               list="area-list" autocomplete="off"
               placeholder="例：渋谷・天神など"
               value="{{ form.instance.area }}">
      </div>
    </p>

    <!-- ジャンル -->
    <p>
      <label>ジャンル（必須）</label>
      <div class="input-with-arrow">
        <input type="text" id="id_genre" name="genre"
               list="genre-list" autocomplete="off"
               placeholder="例：ラーメン・カフェなど"
               value="{{ form.instance.genre }}"
               required>
      </div>
    </p>

    <!-- グループ -->
    <p>
      <label>グループ</label>
      <div class="input-with-arrow">
        <input type="text" id="id_group" name="companions"
               list="group-list" autocomplete="off"
               placeholder="例：友達・家族など"
               value="{{ form.instance.companions }}">
      </div>
    </p>

    <!-- シーン -->
    <p>
      <label>シーン</label>
      <div class="input-with-arrow">
        <input type="text" id="id_scene" name="scene"
               list="scene-list" autocomplete="off"
               placeholder="例：デート・一人など"
               value="{{ form.instance.scene }}">
      </div>
    </p>

    <!-- 休業日 -->
    <p>
      <label>休業日</label>
      {{ form.holiday }}
    </p>

    <!-- タグ -->
    <p>
      <label>タグ</label>
      <div id="tag-container">

        {% if selected_tags %}
          {% for tagname in selected_tags %}
          <div class="tag-row">
            <div class="input-with-arrow">
              <input type="text" name="tags" class="tag-input"
                     value="{{ tagname }}" list="tag-list"
                     placeholder="例：おしゃれ・個室など"
                     autocomplete="off">
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="tag-row">
            <div class="input-with-arrow">
              <input type="text" name="tags" class="tag-input"
                     list="tag-list" autocomplete="off"
                     placeholder="例：おしゃれ・個室など">
            </div>
          </div>
        {% endif %}

      </div>

      <button type="button" id="add-tag" class="add-tag-btn">＋ タグを追加</button>
    </p>

    <button type="submit" class="submit-btn">保存する</button>

  </form>

  <!-- ▼▼▼ Safari対応：datalistは form の外にまとめて配置 ▼▼▼ -->
  <datalist id="area-list">
    {% for w in area_list %}
      <option value="{{ w }}"></option>
    {% endfor %}
  </datalist>

  <datalist id="genre-list">
    {% for w in genre_list %}
      <option value="{{ w }}"></option>
    {% endfor %}
  </datalist>

  <datalist id="group-list">
    {% for w in group_list %}
      <option value="{{ w }}"></option>
    {% endfor %}
  </datalist>

  <datalist id="scene-list">
    {% for w in scene_list %}
      <option value="{{ w }}"></option>
    {% endfor %}
  </datalist>

  <datalist id="tag-list">
    {% for w in tag_list %}
      <option value="{{ w }}"></option>
    {% endfor %}
  </datalist>
  <!-- ▲▲▲ datalist まとめ終わり ▲▲▲ -->

</div>

<script>
document.getElementById("add-tag").addEventListener("click", function() {
  const container = document.getElementById("tag-container");

  const row = document.createElement("div");
  row.className = "tag-row";

  row.innerHTML = `
    <div class="input-with-arrow">
      <input type="text" name="tags"
             class="tag-input"
             placeholder="例：おしゃれ・個室など"
             list="tag-list" autocomplete="off">
    </div>
  `;

  container.appendChild(row);
});
</script>

{% endblock %}
